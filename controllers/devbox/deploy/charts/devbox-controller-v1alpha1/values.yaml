# Default values for devbox controller v1alpha1 helm chart.

replicaCount: 2

image: ghcr.io/labring/sealos-devbox-controller:latest
imagePullPolicy: IfNotPresent

imagePullSecrets: []
nameOverride: ""
fullnameOverride: "devbox"

serviceAccount:
  create: true
  automount: true
  annotations: {}
  name: "controller-manager"

podAnnotations: {}
podLabels: {}

podSecurityContext:
  runAsNonRoot: true

securityContext:
  allowPrivilegeEscalation: false
  capabilities:
    drop:
    - "ALL"

# 资源限制
resources:
  limits:
    cpu: 1500m
    memory: 2000Mi
  requests:
    cpu: 100m
    memory: 640Mi

# 环境变量配置
env:
  registryAddr: "sealos.hub:5000"
  registryUser: "admin"
  registryPassword: "passw0rd"

# 额外的命令行参数
extraArgs:
  - --health-probe-bind-address=:8081

# 额外的环境变量
extraEnv: []
  # - name: CUSTOM_VAR
  #   value: "custom-value"

livenessProbe:
  httpGet:
    path: /healthz
    port: 8081
  initialDelaySeconds: 15
  periodSeconds: 20

readinessProbe:
  httpGet:
    path: /readyz
    port: 8081
  initialDelaySeconds: 5
  periodSeconds: 10

# Metrics（默认关闭；开启后会创建对应 Service 并让 controller 暴露 metrics 端口）
metrics:
  enabled: false
  # 对应 controller 的 --metrics-bind-address 监听端口
  port: 8443

# devbox-service（retag 服务，端口 8092）
devboxService:
  enabled: true
  replicaCount: 3
  image: ghcr.io/labring/sealos-devbox-service:latest
  imagePullPolicy: Always
  service:
    port: 8092
  resources:
    requests:
      cpu: 50m
      memory: 50Mi
    limits:
      cpu: 500m
      memory: 512Mi
  env:
    GIN_MODE: "release"
    LOG_LEVEL: "info"
    USER: "admin"
    PASSWORD: "passw0rd"
    # 用于 devbox-service 的 /tag 接口鉴权（JWT 校验密钥）
    JWTSecret: ""

# Affinity 配置
affinity: {}
  # nodeAffinity:
  #   requiredDuringSchedulingIgnoredDuringExecution:
  #     nodeSelectorTerms:
  #     - matchExpressions:
  #       - key: kubernetes.io/arch
  #         operator: In
  #         values:
  #         - amd64
  #         - arm64

# Node selector
nodeSelector: {}

# Tolerations
tolerations:
  - effect: NoSchedule
    key: devbox.sealos.io/node
    operator: Exists
  - effect: NoExecute
    key: node.kubernetes.io/not-ready
    operator: Exists
  - effect: NoExecute
    key: node.kubernetes.io/unreachable
    operator: Exists

# Termination grace period
terminationGracePeriodSeconds: 10

# Revision history limit
revisionHistoryLimit: 3

