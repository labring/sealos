apiVersion: v1
kind: Namespace
metadata:
  name: objectstorage-frontend
---
apiVersion: apps/v1
kind: Deployment
metadata:
 name: object-storage-frontend
 namespace: objectstorage-frontend
 labels:
   app: object-storage-frontend
spec:
 replicas: 1
 revisionHistoryLimit: 1
 selector:
   matchLabels:
     app: object-storage-frontend
 strategy:
   type: RollingUpdate
   rollingUpdate:
     maxUnavailable: 1
     maxSurge: 0
 template:
   metadata:
     labels:
       app: object-storage-frontend
   spec:
     containers:
       - name: object-storage-frontend
         image: zzfc/sealos-objectstorage:v1.0.2
         ports:
           - containerPort: 3000
             protocol: TCP
         env:
           - name: MONITOR_URL
             value: https://object-storage-monitor.{{ .cloudDomain }}/q
         resources:
           limits:
             cpu: 500m
             memory: 512Mi
           requests:
              cpu: 5m
              memory: 64Mi
         imagePullPolicy: Always
         volumeMounts: []
     volumes: []
---
apiVersion: v1
kind: Service
metadata:
 name: object-storage-frontend
 namespace: objectstorage-frontend
 labels:
   app: object-storage-frontend
spec:
 ports:
   - port: 3000
     targetPort: 3000
     protocol: TCP
 selector:
   app: object-storage-frontend
---
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  annotations:
    kubernetes.io/ingress.class: nginx
    nginx.ingress.kubernetes.io/configuration-snippet: |
      if (\$request_uri ~* \.(js|css|gif|jpe?g|png)) {
        expires 30d;
        add_header Cache-Control "public";
      }
    nginx.ingress.kubernetes.io/cors-allow-methods: PUT, GET, POST, DELETE, PATCH, OPTIONS
    nginx.ingress.kubernetes.io/cors-allow-origin: '*'
    nginx.ingress.kubernetes.io/proxy-body-size: 3g
    nginx.ingress.kubernetes.io/proxy-next-upstream-timeout: '180'
    nginx.ingress.kubernetes.io/proxy-send-timeout: '180'
  name: object-storage-frontend
  namespace: objectstorage-frontend
spec:
  rules:
  - host: objectstorage.{{ .cloudDomain }}
    http:
      paths:
      - backend:
          service:
            name: object-storage-frontend
            port:
              number: 3000
        path: /()(.*)
        pathType: Prefix
  tls:
  - hosts:
    - objectstorage.{{ .cloudDomain }}
    secretName: wildcard-cert