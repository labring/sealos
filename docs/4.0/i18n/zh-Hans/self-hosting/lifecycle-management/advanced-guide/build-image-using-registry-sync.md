---
sidebar_position: 2
---

# é•œåƒæ„å»ºæ”¹è¿›æŒ‡å—

## æ·±å…¥ç†è§£Sealosé•œåƒæ„å»º

ä¸ºäº†äº†è§£Sealosé•œåƒæ„å»ºçš„èƒŒåæ‰€åšçš„å·¥ä½œï¼Œæˆ‘ä»¬å°†é¦–å…ˆæ­ç¤ºå®ƒåœ¨åº•å±‚ç©¶ç«Ÿè¿›è¡Œäº†å“ªäº›æ“ä½œã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç›´è§‚çš„æ¶æ„å›¾ï¼š

![](images/build.png)

Sealosåœ¨æ„å»ºé•œåƒè¿‡ç¨‹ä¸­æ¶µç›–äº†ä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒæ­¥éª¤ï¼š

- **ç¼“å­˜é•œåƒ**ï¼šè§£ææ„å»ºæ‰§è¡Œæ—¶çš„å·¥ä½œç›®å½•ï¼ˆåœ¨è¿™é‡Œæˆ‘ä»¬ç§°ä¹‹ä¸º"context"ç›®å½•ï¼‰ï¼Œå°†ç¼“å­˜é•œåƒä¿å­˜åˆ°registryç»“æ„å¹¶å­˜å‚¨åœ¨./registryç›®å½•ä¸‹ã€‚
- **æ„å»ºé•œåƒ**ï¼šåœ¨contextç›®å½•ä¸­è¿›è¡Œé•œåƒæ„å»ºï¼Œç”Ÿæˆæ–°çš„é•œåƒã€‚ï¼ˆè¯·æ³¨æ„ï¼Œæ„å»ºé•œåƒæ—¶éœ€è¦å°†./registryç›®å½•è¿›è¡Œå¤åˆ¶ã€‚ï¼‰

## æå‡é•œåƒæ„å»ºæ•ˆç‡

å½“å‰é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å€Ÿç”¨äº†`github.com/distribution/distribution`çš„æºä»£ç ï¼Œåœ¨æ‰§è¡Œç¼“å­˜é•œåƒçš„è¿‡ç¨‹ä¸­ç›´æ¥è°ƒç”¨äº†registryçš„sdkå¹¶å¯åŠ¨äº†registry-proxyåŠŸèƒ½ã€‚å€ŸåŠ©äºé•œåƒä»“åº“çš„ç¼“å­˜èƒ½åŠ›ï¼Œæˆ‘ä»¬å°†é•œåƒç¼“å­˜å¹¶å­˜å…¥context/registryç›®å½•ã€‚

è¿™ä¸ªè¿‡ç¨‹çš„å…³é”®å°±åœ¨äºè°ƒç”¨äº†distributionä»“åº“çš„æ–¹æ³•è¿›è¡Œä¿å­˜é•œåƒï¼š

- å¯åŠ¨ registry-proxy åŠŸèƒ½ã€‚
- ä¿å­˜é•œåƒæ‘˜è¦åŠç´¢å¼•ç›¸å…³æ•°æ®ï¼ˆé€šè¿‡è°ƒç”¨saveManifestAndGetDigestæ–¹æ³•ï¼‰ã€‚
- ä¿å­˜é•œåƒæ–‡ä»¶æ•°æ®ï¼ˆé€šè¿‡è°ƒç”¨saveBlobsæ–¹æ³•ï¼‰ã€‚

è¿™ç§æ–¹æ³•ç¡®å®å…·æœ‰ä¸€äº›æ˜¾è‘—çš„ä¼˜ç‚¹ï¼š

- è½»é‡åŒ–ï¼šæ— éœ€ä¾èµ–å…¶ä»–ç»„ä»¶å³å¯ä¿å­˜é•œåƒã€‚
- è‡ªç”±æ§åˆ¶ï¼šå¯ä»¥è‡ªç”±æ§åˆ¶ä¿å­˜é€»è¾‘ï¼Œæ— éœ€ä¾èµ–ç¬¬ä¸‰æ–¹ç»„ä»¶ã€‚

ç„¶è€Œï¼Œæˆ‘ä»¬ä¹Ÿæ³¨æ„åˆ°äº†ä¸€äº›æ½œåœ¨çš„é—®é¢˜ï¼š

- å¯¹æ–°æ‰‹æ¥è¯´ï¼Œä»£ç ç†è§£éš¾åº¦è¾ƒé«˜ï¼Œä¸æ˜“æ¸…æ™°äº†è§£è¿™é‡Œçš„é€»è¾‘ã€‚
- æ— æ³•ç¼“å­˜ä½¿ç”¨tokenè®¤è¯çš„æ–¹å¼ã€‚
- éœ€è¦ä¾èµ–ä¸€äº›ä¸´æ—¶å­˜å‚¨ç©ºé—´ï¼Œå¯¹ç©ºé—´æœ‰è¦æ±‚ã€‚

è€ƒè™‘åˆ°è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬å†³å®šå°è¯•ä¸€ç§æ–°çš„æ¨¡å¼ï¼šåœ¨æœ¬åœ°å¯åŠ¨ä¸€ä¸ªè½»é‡çš„registryï¼Œä½¿ç”¨`skopeo copy`çš„sdkè¿›è¡Œä»£ç å¤ç”¨ã€‚è¿™ä¸€æ”¹å˜ç›´æ¥è§£å†³äº†ä¹‹å‰æ‰€æœ‰çš„é—®é¢˜ã€‚

![](images/registry-build.png)

**æ‰€ä»¥ï¼Œæ–°çš„æ„å»ºæ–¹å¼ âœ¨é•œåƒä»“åº“åŒæ­¥âœ¨ ä¼˜é›…ç™»åœº ğŸ‰ğŸ‰**

å®˜æ–¹ä»“åº“ä¸­çš„[#3154](https://github.com/labring/sealos/pull/3154)è¿™ä¸ªPRå·²ç»å®Œæˆäº†è¿™ä¸ªåŠŸèƒ½çš„å®ç°ã€‚ç›®å‰ï¼ŒSealosæ”¯æŒè¿™ä¸¤ç§æ–¹å¼è¿›è¡Œé•œåƒæ„å»ºã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä¼šä»‹ç»å¦‚ä½•å¯åŠ¨æ–°åŠŸèƒ½ï¼ˆå¦‚æœæ–°åŠŸèƒ½è¡¨ç°ç¨³å®šï¼Œæˆ‘ä»¬å¯èƒ½ä¼šåºŸå¼ƒæ—§çš„æ„å»ºæ–¹å¼ï¼‰ã€‚

## å¦‚ä½•å¯åŠ¨æ–°åŠŸèƒ½

> Sealos v4.3.0 ä»¥ä¸Šç‰ˆæœ¬é»˜è®¤æ”¯æŒæ­¤åŠŸèƒ½ã€‚

å¯åŠ¨æ–°åŠŸèƒ½éå¸¸ç®€å•ï¼Œåªéœ€åœ¨ä½ æ„å»ºé•œåƒä¹‹å‰æ·»åŠ ä¸€ä¸ªç¯å¢ƒå˜é‡å³å¯ã€‚è¿™ä¸ªåŠŸèƒ½åŒæ—¶æ”¯æŒbuildå’Œmergeä¸¤ä¸ªå‘½ä»¤ã€‚

```shell
SEALOS_REGISTRY_SYNC_EXPERIMENTAL=true sealos build -t test .
```

ä»¥ä¸‹æ˜¯æ‰§è¡Œä¸Šè¿°å‘½ä»¤åçš„é¢„æœŸè¾“å‡ºï¼š

```tex
SEALOS_REGISTRY_SYNC_EXPERIMENTAL=true sealos build -t test .
Getting image source signatures
Copying blob fee740108510 done
Copying config f92f3ea6e4 done
Writing manifest to image destination
Storing signatures
Getting image source signatures
Copying blob 08409d417260 done
Copying config 44dd6f2230 done
Writing manifest to image destination
Storing signatures
2023-06-01T13:16:07 info saving images busybox, alpine
STEP 1/2: FROM scratch
STEP 2/2: COPY registry ./registry
COMMIT test
Getting image source signatures
Copying blob 13ab73c881c8 done
Copying config 4e22d16b36 done
Writing manifest to image destination
Storing signatures
--> 4e22d16b366
Successfully tagged localhost/test:latest
4e22d16b366e9fec25641522a74cbd73a7db67dc0516b8f8e00200c4d0551592
```

å¸Œæœ›ä»¥ä¸Šå†…å®¹å¯ä»¥å¸®åŠ©æ‚¨æ›´å¥½åœ°ç†è§£å¹¶ä½¿ç”¨Sealosçš„æ–°é•œåƒæ„å»ºæ–¹å¼ã€‚
