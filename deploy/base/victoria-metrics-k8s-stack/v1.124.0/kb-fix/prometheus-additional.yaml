- honor_labels: true
  job_name: kubeblocks-service
  kubernetes_sd_configs:
    - role: endpoints
  relabel_configs:
    - action: keep
      regex: kubeblocks
      source_labels:
        - __meta_kubernetes_service_label_app_kubernetes_io_managed_by
    - action: drop
      regex: agamotto
      source_labels:
        - __meta_kubernetes_service_label_monitor_kubeblocks_io_managed_by
    - action: keep
      regex: true
      source_labels:
        - __meta_kubernetes_service_annotation_monitor_kubeblocks_io_scrape
    - action: replace
      regex: (https?)
      source_labels:
        - __meta_kubernetes_service_annotation_monitor_kubeblocks_io_scheme
      target_label: __scheme__
    - action: replace
      regex: (.+)
      source_labels:
        - __meta_kubernetes_service_annotation_monitor_kubeblocks_io_path
      target_label: __metrics_path__
    - action: replace
      regex: (.+?)(?::\d+)?;(\d+)
      replacement: $1:$2
      source_labels:
        - __address__
        - __meta_kubernetes_service_annotation_monitor_kubeblocks_io_port
      target_label: __address__
    - action: labelmap
      regex: __meta_kubernetes_service_annotation_monitor_kubeblocks_io_param_(.+)
      replacement: __param_$1
    - action: labelmap
      regex: __meta_kubernetes_service_label_(.+)
    - action: replace
      source_labels:
        - __meta_kubernetes_namespace
      target_label: namespace
    - action: replace
      source_labels:
        - __meta_kubernetes_service_name
      target_label: service
    - action: replace
      source_labels:
        - __meta_kubernetes_pod_node_name
      target_label: node
    - action: replace
      source_labels:
        - __meta_kubernetes_pod_name
      target_label: pod
    - action: drop
      regex: Pending|Succeeded|Failed|Completed
      source_labels:
        - __meta_kubernetes_pod_phase
- honor_labels: true
  job_name: kubeblocks-agamotto
  kubernetes_sd_configs:
    - role: endpoints
  relabel_configs:
    - action: keep
      regex: agamotto
      source_labels:
        - __meta_kubernetes_service_label_monitor_kubeblocks_io_managed_by
    - action: keep
      regex: true
      source_labels:
        - __meta_kubernetes_service_annotation_monitor_kubeblocks_io_scrape
    - action: replace
      regex: (https?)
      source_labels:
        - __meta_kubernetes_service_annotation_monitor_kubeblocks_io_scheme
      target_label: __scheme__
    - action: replace
      regex: (.+)
      source_labels:
        - __meta_kubernetes_service_annotation_monitor_kubeblocks_io_path
      target_label: __metrics_path__
    - action: replace
      regex: (.+?)(?::\d+)?;(\d+)
      replacement: $1:$2
      source_labels:
        - __address__
        - __meta_kubernetes_service_annotation_monitor_kubeblocks_io_port
      target_label: __address__
    - action: labelmap
      regex: __meta_kubernetes_service_annotation_monitor_kubeblocks_io_param_(.+)
      replacement: __param_$1
    - action: drop
      regex: Pending|Succeeded|Failed|Completed
      source_labels:
        - __meta_kubernetes_pod_phase